{% extends "components/layout.html" %}

{% block title %}Network Observability - LinkedEye-FinSpot{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-left">
        <h1 class="page-title">Network Observability</h1>
        <p class="page-subtitle">Real-time infrastructure topology and health monitoring</p>
    </div>
    <div class="page-header-right">
        <button class="btn btn-secondary" id="auto-refresh-btn" onclick="toggleAutoRefresh()">
            <i class="fas fa-sync-alt"></i> Auto-Refresh: <span id="refresh-status">Off</span>
        </button>
        <button class="btn btn-secondary" onclick="exportTopology()">
            <i class="fas fa-download"></i> Export
        </button>
        <button class="btn btn-primary" onclick="openGrafana()">
            <i class="fas fa-external-link-alt"></i> Open Grafana
        </button>
    </div>
</div>

<!-- Health Overview -->
<div class="stats-grid stats-grid-4">
    <div class="stat-card stat-card-lg">
        <div class="stat-icon stat-icon-green">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
            <span class="stat-value" id="stat-healthy">0</span>
            <span class="stat-label">Healthy</span>
        </div>
        <div class="stat-trend trend-up">
            <i class="fas fa-arrow-up"></i> 98%
        </div>
    </div>
    <div class="stat-card stat-card-lg">
        <div class="stat-icon stat-icon-yellow">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-content">
            <span class="stat-value" id="stat-warning">0</span>
            <span class="stat-label">Warning</span>
        </div>
    </div>
    <div class="stat-card stat-card-lg">
        <div class="stat-icon stat-icon-red">
            <i class="fas fa-times-circle"></i>
        </div>
        <div class="stat-content">
            <span class="stat-value" id="stat-critical">0</span>
            <span class="stat-label">Critical</span>
        </div>
    </div>
    <div class="stat-card stat-card-lg">
        <div class="stat-icon stat-icon-gray">
            <i class="fas fa-question-circle"></i>
        </div>
        <div class="stat-content">
            <span class="stat-value" id="stat-unknown">0</span>
            <span class="stat-label">Unknown</span>
        </div>
    </div>
</div>

<!-- Network Topology -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title"><i class="fas fa-project-diagram"></i> Infrastructure Topology</h3>
        <div class="card-header-actions">
            <div class="topology-controls">
                <button class="btn btn-sm btn-secondary" onclick="zoomIn()">
                    <i class="fas fa-search-plus"></i>
                </button>
                <button class="btn btn-sm btn-secondary" onclick="zoomOut()">
                    <i class="fas fa-search-minus"></i>
                </button>
                <button class="btn btn-sm btn-secondary" onclick="resetView()">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
            <select class="form-select form-select-sm" id="topology-layout" onchange="changeLayout()">
                <option value="force">Force Layout</option>
                <option value="hierarchical">Hierarchical</option>
                <option value="circular">Circular</option>
            </select>
        </div>
    </div>
    <div class="card-body no-padding">
        <div class="topology-container" id="topology-container">
            <div class="topology-canvas" id="topology-canvas">
                <!-- D3.js topology rendered here -->
                <div class="loading-overlay" id="topology-loading">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Loading topology...</span>
                    </div>
                </div>
            </div>
            <div class="topology-legend">
                <h4>Legend</h4>
                <div class="legend-items">
                    <span class="legend-item"><span class="legend-dot healthy"></span> Healthy</span>
                    <span class="legend-item"><span class="legend-dot warning"></span> Warning</span>
                    <span class="legend-item"><span class="legend-dot critical"></span> Critical</span>
                    <span class="legend-item"><span class="legend-dot unknown"></span> Unknown</span>
                </div>
                <h4>Node Types</h4>
                <div class="legend-items">
                    <span class="legend-item"><i class="fas fa-server"></i> Server</span>
                    <span class="legend-item"><i class="fas fa-database"></i> Database</span>
                    <span class="legend-item"><i class="fas fa-network-wired"></i> Network</span>
                    <span class="legend-item"><i class="fas fa-balance-scale"></i> Load Balancer</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Active Alerts & Metrics -->
<div class="network-grid">
    <!-- Active Alerts -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-bell"></i> Active Alerts</h3>
            <a href="/incidents?source=PROMETHEUS" class="btn btn-text">View All</a>
        </div>
        <div class="card-body">
            <div class="alerts-list" id="active-alerts">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Resource Utilization -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-area"></i> Resource Utilization</h3>
            <select class="form-select form-select-sm" id="metric-timerange" onchange="updateMetrics()">
                <option value="1h">Last 1 Hour</option>
                <option value="6h">Last 6 Hours</option>
                <option value="24h" selected>Last 24 Hours</option>
                <option value="7d">Last 7 Days</option>
            </select>
        </div>
        <div class="card-body">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">CPU Usage</span>
                        <span class="metric-value" id="metric-cpu">--%</span>
                    </div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="metric-cpu-bar" style="width: 0%"></div>
                    </div>
                    <span class="metric-trend">Avg across all servers</span>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Memory Usage</span>
                        <span class="metric-value" id="metric-memory">--%</span>
                    </div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="metric-memory-bar" style="width: 0%"></div>
                    </div>
                    <span class="metric-trend">Avg across all servers</span>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Disk Usage</span>
                        <span class="metric-value" id="metric-disk">--%</span>
                    </div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="metric-disk-bar" style="width: 0%"></div>
                    </div>
                    <span class="metric-trend">Avg across all servers</span>
                </div>
                <div class="metric-card">
                    <div class="metric-header">
                        <span class="metric-title">Network I/O</span>
                        <span class="metric-value" id="metric-network">-- MB/s</span>
                    </div>
                    <div class="metric-bar">
                        <div class="metric-fill" id="metric-network-bar" style="width: 0%"></div>
                    </div>
                    <span class="metric-trend">Total throughput</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Top Resources -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title"><i class="fas fa-fire"></i> Top Resource Consumers</h3>
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="cpu">CPU</button>
            <button class="tab-btn" data-tab="memory">Memory</button>
            <button class="tab-btn" data-tab="disk">Disk</button>
            <button class="tab-btn" data-tab="network">Network</button>
        </div>
    </div>
    <div class="card-body">
        <div class="tab-content active" id="tab-cpu">
            <div class="top-resources-list" id="top-cpu">
                <!-- List rendered here -->
            </div>
        </div>
        <div class="tab-content" id="tab-memory">
            <div class="top-resources-list" id="top-memory"></div>
        </div>
        <div class="tab-content" id="tab-disk">
            <div class="top-resources-list" id="top-disk"></div>
        </div>
        <div class="tab-content" id="tab-network">
            <div class="top-resources-list" id="top-network"></div>
        </div>
    </div>
</div>

<!-- Node Details Sidebar -->
<div class="sidebar-panel" id="node-details-panel">
    <div class="sidebar-header">
        <h3 id="node-detail-title">Node Details</h3>
        <button class="btn-icon" onclick="closeNodeDetails()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="sidebar-body" id="node-detail-body">
        <!-- Node details loaded here -->
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
let autoRefresh = false;
let refreshInterval = null;
let topologyData = { nodes: [], links: [] };

document.addEventListener('DOMContentLoaded', function() {
    loadTopology();
    loadAlerts();
    loadMetrics();
    loadTopResources();
    setupTabs();
    setupWebSocket();
});

function setupTabs() {
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tab = this.dataset.tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
        });
    });
}

function setupWebSocket() {
    if (typeof io !== 'undefined') {
        const socket = io();
        socket.on('alert:new', (data) => {
            loadAlerts();
            updateTopologyNodeStatus(data.configItemId, 'critical');
        });
        socket.on('alert:resolved', (data) => {
            loadAlerts();
            updateTopologyNodeStatus(data.configItemId, 'healthy');
        });
    }
}

async function loadTopology() {
    try {
        const response = await fetch('/api/proxy/assets?limit=100', {
            headers: { 'Authorization': 'Bearer ' + getToken() }
        });

        const data = await response.json();
        if (data.success) {
            buildTopologyData(data.data);
            renderTopology();
        }
    } catch (error) {
        console.error('Error loading topology:', error);
    } finally {
        document.getElementById('topology-loading').style.display = 'none';
    }
}

function buildTopologyData(assets) {
    // Create nodes
    topologyData.nodes = assets.map(asset => ({
        id: asset.id,
        name: asset.name,
        type: asset.type,
        status: asset.status === 'LIVE' ? 'healthy' : asset.status === 'MAINTENANCE' ? 'warning' : 'unknown',
        ip: asset.ipAddress,
        dataCenter: asset.dataCenter
    }));

    // Create mock links based on data center grouping
    topologyData.links = [];
    const dcGroups = {};
    assets.forEach(asset => {
        const dc = asset.dataCenter || 'default';
        if (!dcGroups[dc]) dcGroups[dc] = [];
        dcGroups[dc].push(asset.id);
    });

    // Connect nodes within same DC
    Object.values(dcGroups).forEach(group => {
        for (let i = 0; i < group.length - 1; i++) {
            topologyData.links.push({
                source: group[i],
                target: group[i + 1]
            });
        }
    });

    // Update stats
    const stats = { healthy: 0, warning: 0, critical: 0, unknown: 0 };
    topologyData.nodes.forEach(n => stats[n.status]++);
    document.getElementById('stat-healthy').textContent = stats.healthy;
    document.getElementById('stat-warning').textContent = stats.warning;
    document.getElementById('stat-critical').textContent = stats.critical;
    document.getElementById('stat-unknown').textContent = stats.unknown;
}

function renderTopology() {
    const container = document.getElementById('topology-canvas');
    const width = container.clientWidth;
    const height = 500;

    // Clear previous
    d3.select('#topology-canvas svg').remove();

    const svg = d3.select('#topology-canvas')
        .append('svg')
        .attr('width', width)
        .attr('height', height);

    const g = svg.append('g');

    // Add zoom behavior
    const zoom = d3.zoom()
        .scaleExtent([0.1, 4])
        .on('zoom', (event) => g.attr('transform', event.transform));

    svg.call(zoom);

    // Create force simulation
    const simulation = d3.forceSimulation(topologyData.nodes)
        .force('link', d3.forceLink(topologyData.links).id(d => d.id).distance(100))
        .force('charge', d3.forceManyBody().strength(-200))
        .force('center', d3.forceCenter(width / 2, height / 2));

    // Draw links
    const link = g.append('g')
        .selectAll('line')
        .data(topologyData.links)
        .join('line')
        .attr('class', 'topology-link');

    // Draw nodes
    const node = g.append('g')
        .selectAll('g')
        .data(topologyData.nodes)
        .join('g')
        .attr('class', d => `topology-node node-${d.status}`)
        .call(d3.drag()
            .on('start', dragstarted)
            .on('drag', dragged)
            .on('end', dragended))
        .on('click', (event, d) => showNodeDetails(d));

    node.append('circle')
        .attr('r', 20)
        .attr('class', d => `node-circle status-${d.status}`);

    node.append('text')
        .attr('class', 'node-icon')
        .attr('text-anchor', 'middle')
        .attr('dominant-baseline', 'middle')
        .text(d => getNodeIcon(d.type));

    node.append('text')
        .attr('class', 'node-label')
        .attr('y', 35)
        .attr('text-anchor', 'middle')
        .text(d => d.name.length > 15 ? d.name.substring(0, 12) + '...' : d.name);

    simulation.on('tick', () => {
        link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);

        node.attr('transform', d => `translate(${d.x},${d.y})`);
    });

    function dragstarted(event, d) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(event, d) {
        d.fx = event.x;
        d.fy = event.y;
    }

    function dragended(event, d) {
        if (!event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }
}

function getNodeIcon(type) {
    const icons = {
        'SERVER': '\uf233',
        'DATABASE': '\uf1c0',
        'NETWORK_DEVICE': '\uf6ff',
        'LOAD_BALANCER': '\uf24e',
        'APPLICATION': '\uf2d0'
    };
    return icons[type] || '\uf1b3';
}

function showNodeDetails(node) {
    const panel = document.getElementById('node-details-panel');
    panel.classList.add('active');

    document.getElementById('node-detail-title').textContent = node.name;
    document.getElementById('node-detail-body').innerHTML = `
        <div class="node-detail-section">
            <div class="node-status-badge status-${node.status}">
                <i class="fas fa-${node.status === 'healthy' ? 'check-circle' : node.status === 'warning' ? 'exclamation-triangle' : 'times-circle'}"></i>
                ${node.status.charAt(0).toUpperCase() + node.status.slice(1)}
            </div>
        </div>
        <div class="node-detail-section">
            <h4>Information</h4>
            <div class="detail-list">
                <div class="detail-item"><label>Type</label><span>${node.type}</span></div>
                <div class="detail-item"><label>IP Address</label><code>${node.ip || 'N/A'}</code></div>
                <div class="detail-item"><label>Data Center</label><span>${node.dataCenter || 'N/A'}</span></div>
            </div>
        </div>
        <div class="node-detail-section">
            <h4>Quick Actions</h4>
            <div class="action-buttons vertical">
                <a href="/assets/${node.id}" class="btn btn-secondary btn-block">
                    <i class="fas fa-info-circle"></i> View Details
                </a>
                <a href="/incidents/create?configItemId=${node.id}" class="btn btn-secondary btn-block">
                    <i class="fas fa-exclamation-triangle"></i> Create Incident
                </a>
                <button class="btn btn-secondary btn-block" onclick="openGrafanaForNode('${node.id}')">
                    <i class="fas fa-chart-line"></i> View Metrics
                </button>
            </div>
        </div>
    `;
}

function closeNodeDetails() {
    document.getElementById('node-details-panel').classList.remove('active');
}

async function loadAlerts() {
    try {
        const response = await fetch('/api/proxy/alerts?status=active&limit=10', {
            headers: { 'Authorization': 'Bearer ' + getToken() }
        });

        const data = await response.json();
        const container = document.getElementById('active-alerts');

        if (data.success && data.data.length > 0) {
            container.innerHTML = data.data.map(alert => `
                <div class="alert-item alert-${alert.severity.toLowerCase()}">
                    <div class="alert-icon">
                        <i class="fas fa-${alert.severity === 'CRITICAL' ? 'times-circle' : 'exclamation-triangle'}"></i>
                    </div>
                    <div class="alert-content">
                        <h4>${alert.name}</h4>
                        <p>${alert.message}</p>
                        <span class="alert-time">${formatRelativeTime(alert.createdAt)}</span>
                    </div>
                    <button class="btn-icon" onclick="acknowledgeAlert('${alert.id}')">
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            `).join('');
        } else {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-check-circle"></i>
                    <p>No active alerts</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading alerts:', error);
    }
}

async function loadMetrics() {
    // Mock metrics - would come from Prometheus integration
    const metrics = {
        cpu: Math.floor(Math.random() * 40 + 30),
        memory: Math.floor(Math.random() * 30 + 50),
        disk: Math.floor(Math.random() * 20 + 40),
        network: (Math.random() * 100 + 50).toFixed(1)
    };

    document.getElementById('metric-cpu').textContent = metrics.cpu + '%';
    document.getElementById('metric-cpu-bar').style.width = metrics.cpu + '%';
    document.getElementById('metric-cpu-bar').className = `metric-fill ${metrics.cpu > 80 ? 'critical' : metrics.cpu > 60 ? 'warning' : ''}`;

    document.getElementById('metric-memory').textContent = metrics.memory + '%';
    document.getElementById('metric-memory-bar').style.width = metrics.memory + '%';
    document.getElementById('metric-memory-bar').className = `metric-fill ${metrics.memory > 80 ? 'critical' : metrics.memory > 60 ? 'warning' : ''}`;

    document.getElementById('metric-disk').textContent = metrics.disk + '%';
    document.getElementById('metric-disk-bar').style.width = metrics.disk + '%';

    document.getElementById('metric-network').textContent = metrics.network + ' MB/s';
    document.getElementById('metric-network-bar').style.width = Math.min(metrics.network / 2, 100) + '%';
}

function loadTopResources() {
    // Mock top resources
    const resources = [
        { name: 'prod-app-01', value: 89, ip: '192.168.1.101' },
        { name: 'prod-db-master', value: 76, ip: '192.168.1.201' },
        { name: 'prod-app-02', value: 65, ip: '192.168.1.102' },
        { name: 'staging-app-01', value: 54, ip: '192.168.2.101' },
        { name: 'prod-cache-01', value: 43, ip: '192.168.1.150' }
    ];

    ['cpu', 'memory', 'disk', 'network'].forEach(type => {
        const container = document.getElementById('top-' + type);
        container.innerHTML = resources.map((r, i) => `
            <div class="top-resource-item">
                <span class="rank">#${i + 1}</span>
                <div class="resource-info">
                    <span class="resource-name">${r.name}</span>
                    <code class="resource-ip">${r.ip}</code>
                </div>
                <div class="resource-bar-container">
                    <div class="resource-bar" style="width: ${r.value}%"></div>
                </div>
                <span class="resource-value">${r.value}%</span>
            </div>
        `).join('');
    });
}

function toggleAutoRefresh() {
    autoRefresh = !autoRefresh;
    document.getElementById('refresh-status').textContent = autoRefresh ? 'On' : 'Off';

    if (autoRefresh) {
        refreshInterval = setInterval(() => {
            loadAlerts();
            loadMetrics();
        }, 30000);
    } else {
        clearInterval(refreshInterval);
    }
}

function zoomIn() {
    d3.select('#topology-canvas svg').transition().call(
        d3.zoom().scaleBy, 1.3
    );
}

function zoomOut() {
    d3.select('#topology-canvas svg').transition().call(
        d3.zoom().scaleBy, 0.7
    );
}

function resetView() {
    d3.select('#topology-canvas svg').transition().call(
        d3.zoom().transform, d3.zoomIdentity
    );
}

function changeLayout() {
    // Would change layout algorithm
    renderTopology();
}

function openGrafana() {
    window.open('/integrations/grafana', '_blank');
}

function openGrafanaForNode(nodeId) {
    window.open(`/integrations/grafana?node=${nodeId}`, '_blank');
}

function exportTopology() {
    // Export topology as JSON or image
    const dataStr = JSON.stringify(topologyData, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'topology-export.json';
    a.click();
}

function formatRelativeTime(dateStr) {
    const date = new Date(dateStr);
    const now = new Date();
    const diff = now - date;
    const minutes = Math.floor(diff / 60000);
    if (minutes < 60) return minutes + 'm ago';
    const hours = Math.floor(diff / 3600000);
    if (hours < 24) return hours + 'h ago';
    return Math.floor(diff / 86400000) + 'd ago';
}

function getToken() {
    return localStorage.getItem('authToken') || '';
}
</script>

<style>
.topology-container {
    position: relative;
    min-height: 500px;
}

.topology-canvas {
    width: 100%;
    height: 500px;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
}

.topology-legend {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: var(--bg-card);
    padding: 1rem;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-color);
}

.topology-legend h4 {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin: 0 0 0.5rem 0;
    text-transform: uppercase;
}

.legend-items {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
}

.legend-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.legend-dot.healthy { background: var(--success); }
.legend-dot.warning { background: var(--warning); }
.legend-dot.critical { background: var(--danger); }
.legend-dot.unknown { background: var(--text-secondary); }

.topology-link {
    stroke: var(--border-color);
    stroke-width: 2;
    opacity: 0.6;
}

.node-circle {
    fill: var(--bg-secondary);
    stroke-width: 3;
}

.node-circle.status-healthy { stroke: var(--success); }
.node-circle.status-warning { stroke: var(--warning); }
.node-circle.status-critical { stroke: var(--danger); }
.node-circle.status-unknown { stroke: var(--text-secondary); }

.node-icon {
    font-family: 'Font Awesome 5 Free';
    font-weight: 900;
    font-size: 14px;
    fill: var(--text-primary);
}

.node-label {
    font-size: 10px;
    fill: var(--text-secondary);
}

.topology-node {
    cursor: pointer;
}

.topology-node:hover .node-circle {
    filter: brightness(1.2);
}

.sidebar-panel {
    position: fixed;
    right: -400px;
    top: 0;
    width: 400px;
    height: 100vh;
    background: var(--bg-card);
    border-left: 1px solid var(--border-color);
    z-index: 1000;
    transition: right 0.3s ease;
    display: flex;
    flex-direction: column;
}

.sidebar-panel.active {
    right: 0;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
}

.sidebar-body {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
}

.node-detail-section {
    margin-bottom: 1.5rem;
}

.node-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-md);
    font-weight: 600;
}

.node-status-badge.status-healthy {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
}

.node-status-badge.status-warning {
    background: rgba(245, 158, 11, 0.1);
    color: var(--warning);
}

.node-status-badge.status-critical {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
}

.network-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

@media (max-width: 1024px) {
    .network-grid {
        grid-template-columns: 1fr;
    }
}

.alerts-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.alert-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
    border-radius: var(--radius-md);
    background: var(--bg-secondary);
}

.alert-item.alert-critical {
    border-left: 3px solid var(--danger);
}

.alert-item.alert-warning {
    border-left: 3px solid var(--warning);
}

.alert-icon {
    font-size: 1.25rem;
}

.alert-item.alert-critical .alert-icon {
    color: var(--danger);
}

.alert-item.alert-warning .alert-icon {
    color: var(--warning);
}

.alert-content {
    flex: 1;
}

.alert-content h4 {
    margin: 0 0 0.25rem 0;
    font-size: 0.875rem;
}

.alert-content p {
    margin: 0;
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.alert-time {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}

.metric-card {
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
}

.metric-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.metric-title {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.metric-value {
    font-size: 1.25rem;
    font-weight: 600;
}

.metric-bar {
    height: 6px;
    background: var(--bg-tertiary);
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.metric-fill {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
    transition: width 0.3s ease;
}

.metric-fill.warning {
    background: var(--warning);
}

.metric-fill.critical {
    background: var(--danger);
}

.metric-trend {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.top-resource-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border-color);
}

.top-resource-item:last-child {
    border-bottom: none;
}

.rank {
    font-weight: 600;
    color: var(--text-secondary);
    width: 2rem;
}

.resource-info {
    flex: 1;
}

.resource-name {
    display: block;
    font-weight: 500;
}

.resource-ip {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.resource-bar-container {
    width: 100px;
    height: 6px;
    background: var(--bg-tertiary);
    border-radius: 3px;
    overflow: hidden;
}

.resource-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 3px;
}

.resource-value {
    font-weight: 600;
    min-width: 3rem;
    text-align: right;
}

.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg-secondary);
}
</style>
{% endblock %}
